/**
 * Forkfile 0.1.0
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 * 
 * Copyright (C) 2012 lambdalisue, hashnote.net allright reserved.
 */
(function(){var j,p,e,h,d,f,m,b,n,c,i,l,o,k,a,g=[].slice;d=(function(){function q(){}q.reset="\x1b[0m";q.bold="\x1b[0;1m";q.red="\x1b[0;31m";q.green="\x1b[0;32m";q.check="\u2713";q.cross="\u2A2F";q.prototype.log=function(){return console.log.apply(this,arguments)};q.prototype.warn=function(){return console.warn.apply(this,arguments)};q.prototype.info=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.green);r.push(q.reset);return this.log.apply(this,r)};q.prototype.error=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.red);r.push(q.reset);return this.warn.apply(this,r)};q.prototype.title=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.bold);r.push(q.reset);return this.log.apply(this,r)};q.prototype.success=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.check);return this.info.apply(this,r)};q.prototype.fail=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.cross);return this.error.apply(this,r)};return q})();exports.konsole=new d;i=require("fs");o=require("path");k=require("child_process").spawn;exports.exists=function(){if(i.exists!=null){return i.exists.apply(i,arguments)}else{return o.exists.apply(o,arguments)}};exports.existsSync=function(){if(i.existsSync!=null){return i.existsSync.apply(i,arguments)}else{return o.existsSync.apply(o,arguments)}};exports.execFile=function(t,s,r){var q;q=k(t,s);q.stdout.on("data",function(u){return process.stdout.write(u)});q.stderr.on("data",function(u){return process.stderr.write(u)});if(r){q.on("exit",function(u){return r(u)})}return q};exports.readAllFiles=function(r,s,x){var t,q,y,v,w,z,u;if(!x){x=s;s="utf-8"}q=new Array;v=r.length;u=[];for(y=w=0,z=r.length;w<z;y=++w){t=r[y];u.push((function(B,A){return i.readFile(B,s,function(C,D){if(C){throw C}q[A]=D;if(--v===0){return x(q.join("\n"))}})})(t,y))}return u};exports.makedirs=function(q){var r;r=require("mkdirp");if(!exports.existsSync(q)){return r.sync(q)}};exports.globset=function(q,w){var t,v,z,u,y,s,r,x;v=require("glob");y=require("underscore");z={cwd:w,root:w};t=new Array;for(r=0,x=q.length;r<x;r++){u=q[r];if(u.lastIndexOf("-",0)===0){s=v.sync(u.slice(1),z);t=y.difference(t,s)}else{s=v.sync(u,z);t=t.concat(s)}}return t};c="~/.yuicompressor/build/yuicompressor-2.4.7.jar";j="./node_modules/coffeelint/bin/coffeelint";p="./config/coffeelint.json";h="./node_modules/coverjs/bin/cover.js";f="./node_modules/mocha/bin/mocha";exports.coffee=function(q,w,r,u){var x,y,v,t,s;x=require("coffee-script");y=function(z){var A;if(!z){return}A=x.compile(z,{bare:r.bare});if(!r.dry){return i.writeFile(w,A,r.encoding,function(B){if(B){throw B}if(u){return u()}})}else{if(u){return u()}}};r.encoding=(v=r.encoding)!=null?v:"utf-8";exports.makedirs(o.dirname(w));if(typeof q==="string"){r.bare=(t=r.bare)!=null?t:true;return i.readFile(q,r.encoding,function(z,A){if(z){throw z}return y(A)})}else{r.bare=(s=r.bare)!=null?s:false;return exports.readAllFiles(q,r.encoding,y)}};exports.less=function(q,w,r,u){var y,x,t,A,z,v;x=require("less");y=function(B,s){if(!s){return}return B.parse(s,function(E,C){var D;if(E){throw E}D=C.toCSS();if(!r.dry){return i.writeFile(w,D,r.encoding,function(F){if(F){throw F}if(u){return u()}})}else{if(u){return u()}}})};r.encoding=(v=r.encoding)!=null?v:"utf-8";exports.makedirs(o.dirname(w));if(typeof q==="string"){t=new x.Parser({paths:[o.dirname(q)],filename:w});return i.readFile(q,r.encoding,function(s,B){if(s){throw s}return y(t,B)})}else{A=[(function(){var C,B,s;s=[];for(C=0,B=q.length;C<B;C++){z=q[C];s.push(o.dirname(z))}return s})()];t=new x.Parser({paths:A,filename:w});return exports.readAllFiles(q,r.encoding,function(s){return y(t,s)})}};exports.minify=function(t,v,r){var s,u,q;q=require("child_process").exec;u=process.env.YUI_COMPRESSOR||c;s=["-jar",u,t,"-o",v];return q("java "+s.join(" "),function(y,w,x){if(y){throw y}if(w){console.log(w)}if(x){console.warn(x)}if(r){return r()}})};exports.coffeelint=function(t,s,q){var r,u;u=process.env.COFFEELINT||j;if(s){r=["-f",s].concat(t)}else{r=t}return exports.execFile(u,r,q)};exports.coverjs=function(s,u,q){var r,t;t=process.env.COVERJS||h;r=["--recursive"].concat(s).concat(["--output",u]);return exports.execFile(t,r,q)};exports.mocha=function(u,r){var t,q,s;q=require("child_process").exec;s=process.env.MOCHA||f;t=["--compilers","coffee:coffee-script"].concat(u);return q(s+" "+t.join(" "),function(x,v,w){if(x){throw x}if(v){console.log(v)}if(w){console.warn(w)}if(r){return r()}})};n="test.html.template";b='<!DOCTYPE html>\n<html>\n<head>\n    <meta charset="utf-8">\n    <title>Unittest via Mocha</title>\n    <link rel="stylesheet" href="vender/mocha.css">\n    <link rel="stylesheet" href="vender/reporter.css">\n    <% _.each(stylesheets, function(filename) { %>\n    <link rel="stylesheet" href="<%= filename %>">\n    <% }); %>\n</head>\n<body>\n    <div id="mocha"></div>\n    <div id="coverage"></div>\n    <div id="menu"></div>\n    <script src="vender/jquery.min.js"><\/script>\n    <script src="vender/underscore-min.js"><\/script>\n    <script src="vender/backbone-min.js"><\/script>\n    <script src="vender/mocha.js"><\/script>\n    <script src="vender/expect.js"><\/script>\n    <script src="vender/reporter.js"><\/script>\n    <script src="vender/JSCovReporter.js"><\/script>\n    <script>\n        mocha.setup({\n            ui: \'bdd\',\n            ignoreLeaks: true\n        });\n    <\/script>\n    <% _.each(javascripts, function(filename) { %>\n    <script src="<%= filename %>"><\/script>\n    <% }); %>\n    <script>\n        $(function() {\n            mocha.run(function () {\n                if (typeof window.__$coverObject !== \'undefined\') {\n                    var reporter = new JSCovReporter({ coverObject: window.__$coverObject });\n                }\n            });\n        });\n    <\/script>\n</body>\n</html>';exports.loadTemplate=function(r,v,w,u){var t,s,q;if(u==null){u="utf-8"}q=require("underscore");s=o.join(r,n);if(!exports.existsSync(s)){i.writeFileSync(s,b,u)}t=i.readFileSync(s,u);t=q.template(t);return t({stylesheets:w,javascripts:v})};exports.download=function(s,r,q){var t;t=require("request");return t(s,function(w,v,u){if(!w&&v.statusCode===200){return i.writeFile(r,u,"binary",function(x){if(x){throw x}if(q){return q()}})}})};exports.downloadVenders=function(s,v){var t,r,u,w,q;r=require("underscore");w={"jquery.min.js":"http://code.jquery.com/jquery.min.js","underscore-min.js":"http://underscorejs.org/underscore-min.js","backbone-min.js":"http://backbonejs.org/backbone-min.js","mocha.js":"https://raw.github.com/visionmedia/mocha/master/mocha.js","expect.js":"https://raw.github.com/LearnBoost/expect.js/master/expect.js","reporter.js":"https://raw.github.com/TwoApart/JSCovReporter/master/reporter.js","JSCovReporter.js":"https://raw.github.com/TwoApart/JSCovReporter/master/JSCovReporter.js","mocha.css":"https://raw.github.com/visionmedia/mocha/master/mocha.css","reporter.css":"https://raw.github.com/TwoApart/JSCovReporter/master/reporter.css"};if(v){w=r.extend(w,v)}q=[];for(t in w){u=w[t];q.push((function(x,y){x=o.join(s,x);return exports.download(y,x,function(){return exports.konsole.success("Download",y)})})(t,u))}return q};m=["underscore","coffee-script","less","glob","mkdirp","coffeelint","coverjs","mocha","expect.js"];exports.installRequiredModules=function(v){var t,u,q,w,s,r;t=function(x){return exports.execFile("npm",["install",x])};exports.konsole.title("Install required node modeles...");q=m;if(v){q=q.concat(v)}r=[];for(w=0,s=q.length;w<s;w++){u=q[w];r.push(t(u))}return r};d=(function(){function q(){}q.reset="\x1b[0m";q.bold="\x1b[0;1m";q.red="\x1b[0;31m";q.green="\x1b[0;32m";q.check="\u2713";q.cross="\u2A2F";q.prototype.log=function(){return console.log.apply(this,arguments)};q.prototype.warn=function(){return console.warn.apply(this,arguments)};q.prototype.info=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.green);r.push(q.reset);return this.log.apply(this,r)};q.prototype.error=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.red);r.push(q.reset);return this.warn.apply(this,r)};q.prototype.title=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.bold);r.push(q.reset);return this.log.apply(this,r)};q.prototype.success=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.check);return this.info.apply(this,r)};q.prototype.fail=function(){var r;r=1<=arguments.length?g.call(arguments,0):[];r.unshift(q.cross);return this.error.apply(this,r)};return q})();exports.konsole=new d;a=require("url");l=require("http");e={".html":"text/html",".js":"text/javascript",".css":"text/css",".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif"};exports.createStaticServer=function(r){var q;q=function(w,u){var t,s,v;s=function(z){var A,y,x;y=o.extname(z);for(x in e){A=e[x];if(x===y){return A}}return"text/plain"};v=a.parse(w.url).pathname;v=v==="/"?"index.html":v;t=o.join(r,v);return exports.exists(t,function(x){if(!x){if(v==="/favicon.ico"){exports.konsole.warn("404","Not found",v)}u.writeHead(404,{"Content-Type":"text/plain"});u.write("404 Not found\n"+t+"\n");u.end();return}return i.readFile(t,"binary",function(z,y){if(z){exports.konsole.error("500","Server error",v);u.writeHead(500,{"Content-Type":"text/plain"});u.write(""+z+"\n"+t+"\n");u.end();return}exports.konsole.info("200","OK",v);u.writeHead(200,{"Content-Type":s(v)});u.write(y,"binary");return u.end()})})};return l.createServer(q)};i=require("fs");o=require("path");k=require("child_process").spawn;exports.exists=function(){if(i.exists!=null){return i.exists.apply(i,arguments)}else{return o.exists.apply(o,arguments)}};exports.existsSync=function(){if(i.existsSync!=null){return i.existsSync.apply(i,arguments)}else{return o.existsSync.apply(o,arguments)}};exports.execFile=function(t,s,r){var q;q=k(t,s);q.stdout.on("data",function(u){return process.stdout.write(u)});q.stderr.on("data",function(u){return process.stderr.write(u)});if(r){q.on("exit",function(u){return r(u)})}return q};exports.readAllFiles=function(r,s,x){var t,q,y,v,w,z,u;if(!x){x=s;s="utf-8"}q=new Array;v=r.length;u=[];for(y=w=0,z=r.length;w<z;y=++w){t=r[y];u.push((function(B,A){return i.readFile(B,s,function(C,D){if(C){throw C}q[A]=D;if(--v===0){return x(q.join("\n"))}})})(t,y))}return u};exports.makedirs=function(q){var r;r=require("mkdirp");if(!exports.existsSync(q)){return r.sync(q)}};exports.globset=function(q,w){var t,v,z,u,y,s,r,x;v=require("glob");y=require("underscore");z={cwd:w,root:w};t=new Array;for(r=0,x=q.length;r<x;r++){u=q[r];if(u.lastIndexOf("-",0)===0){s=v.sync(u.slice(1),z);t=y.difference(t,s)}else{s=v.sync(u,z);t=t.concat(s)}}return t}}).call(this);
