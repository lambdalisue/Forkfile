/**
 * Forkfile 0.2.2
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 *
 * Copyright (C) 2012 lambdalisue, hashnote.net all right reserved.
 */
(function(){var E,I,G,L,C,B,N,D,A,M,P,Q,J,H,R,O,F,K=[].slice;E=(function(){S.reset="\x1b[0m";S.bold="\x1b[1m";S.red="\x1b[31m";S.green="\x1b[32m";S.check="\u2713";S.cross="\u2A2F";function S(){var T=this;this.noColor=false;this.log.strong=function(){var U;U=1<=arguments.length?K.call(arguments,0):[];if(!T.noColor){U.unshift(S.bold)}if(!T.noColor){U.push(S.reset)}return T.log.apply(T,U)};this.info.strong=function(){var U;U=1<=arguments.length?K.call(arguments,0):[];if(!T.noColor){U.unshift(S.bold)}if(!T.noColor){U.unshift(S.green)}if(!T.noColor){U.push(S.reset)}return T.log.apply(T,U)};this.error.strong=function(){var U;U=1<=arguments.length?K.call(arguments,0):[];if(!T.noColor){U.unshift(S.bold)}if(!T.noColor){U.unshift(S.red)}if(!T.noColor){U.push(S.reset)}return T.warn.apply(T,U)}}S.prototype.log=console.log;S.prototype.warn=console.warn;S.prototype.info=function(){var T;T=1<=arguments.length?K.call(arguments,0):[];if(!this.noColor){T.unshift(S.green)}if(!this.noColor){T.push(S.reset)}return this.log.apply(this,T)};S.prototype.error=function(){var T;T=1<=arguments.length?K.call(arguments,0):[];if(!this.noColor){T.unshift(S.red)}if(!this.noColor){T.push(S.reset)}return this.warn.apply(this,T)};S.prototype.success=function(){var T;T=1<=arguments.length?K.call(arguments,0):[];T.unshift(S.check);return this.info.apply(this,T)};S.prototype.fail=function(){var T;T=1<=arguments.length?K.call(arguments,0):[];T.unshift(S.cross);return this.error.apply(this,T)};return S})();exports.konsole=M=new E;B=require("fs");J=require("path");H=require("child_process").spawn;exports.installRequiredModules=function(X){var V,W,S,Y,U,T;V=function(Z){return exports.execFile("npm",["install",Z])};console.log.strong("Install required node modeles...");S=exports.installRequiredModules.REQUIRED_NODE_MODULES;if(X){S=S.concat(X)}T=[];for(Y=0,U=S.length;Y<U;Y++){W=S[Y];T.push(V(W))}return T};exports.installRequiredModules.REQUIRED_NODE_MODULES=["underscore","coffee-script","less","glob","mkdirp","coffeelint","coverjs","mocha","expect.js","mocha-phantomjs"];exports.exists=B.exists||J.exists;exports.existsSync=B.existsSync||J.existsSync;exports.execFile=function(V,U,T){var S;S=H(V,U);S.stdout.on("data",function(W){return process.stdout.write(W)});S.stderr.on("data",function(W){return process.stderr.write(W)});if(T){S.on("exit",function(W){return T(W)})}return S};exports.readAllFiles=function(T,U,Z){var V,S,a,X,Y,b,W;if(!Z){Z=U;U="utf-8"}S=new Array;X=T.length;W=[];for(a=Y=0,b=T.length;Y<b;a=++Y){V=T[a];W.push((function(d,c){return B.readFile(d,U,function(e,f){if(e){throw e}S[c]=f;if(--X===0){return Z(S.join("\n"))}})})(V,a))}return W};exports.compose=function(U,V,T,S){return exports.readAllFiles(U,T,function(W){return B.writeFile(V,W,T,function(X){if(X){throw X}if(S){return S()}})})};exports.makedirs=function(S){var T;T=require("mkdirp");if(!exports.existsSync(S)){return T.sync(S)}};exports.copyFile=function(U,W,V){var S,T;S=B.createReadStream(U);T=B.createWriteStream(W);S.pipe(T);return S.on("end",function(){if(V){return V()}})};exports.globset=function(S,Z,T){var W,Y,c,X,b,V,U,a;Y=require("glob");b=require("underscore");c={cwd:Z};W=new Array;for(U=0,a=S.length;U<a;U++){X=S[U];if(X.lastIndexOf("-",0)===0){X=X.slice(1);if(T){X=X+T}V=Y.sync(X,c);W=b.difference(W,V)}else{if(T){X=X+T}V=Y.sync(X,c);W=W.concat(V)}}W=b.uniq(W);return b.map(W,function(d){return J.join(Z,d)})};I={};I.coffee=function(U,W,T,S){var V;V=require("coffee-script");exports.makedirs(J.dirname(W));return B.readFile(U,T.encoding,function(Y,X){var Z;if(Y){M.fail("Failed to read",U);M.error("  Error:",Y.message);if(S){S(Y)}return}try{Z=V.compile(X,{bare:T.bare})}catch(Y){M.fail("Failed to compile",U);M.error("  Error:",Y.message);if(S){S(Y)}return}return B.writeFile(W,Z,T.encoding,function(a){if(a){M.fail("Failed to write",W);M.error("  Error:",a.message);if(S){S(a)}return}M.success("Compile",J.join(U),"to",W);if(S){return S()}})})};I.less=function(V,X,U,S){var T,W;T=require("less");exports.makedirs(J.dirname(X));W=new T.Parser({paths:[J.dirname(V)],filename:X});return B.readFile(V,U.encoding,function(Z,Y){if(Z){M.fail("Failed to read",V);M.error("  Error:",Z.message);if(S){S(Z)}return}return W.parse(Y,function(c,a){var b;if(c){M.fail("Failed to parse",V);M.error("  Error:",c.message);if(S){S(c)}return}b=a.toCSS();return B.writeFile(X,b,U.encoding,function(d){if(d){M.fail("Failed to write",X);M.error("  Error:",d.message);if(S){S(d)}return}M.success("Compile",J.join(V),"to",X);if(S){return S()}})})})};exports.compiler=I;F=require("url");N=require("http");D=require("https");Q={};Q.createStaticServer=function(T){var S;S=function(Y,W){var V,U,X;U=function(b){var d,a,Z,c;a=J.extname(b);c=Q.createStaticServer.CONTENT_TYPES;for(Z in c){d=c[Z];if(Z===a){return d}}return"text/plain"};X=F.parse(Y.url).pathname;X=X==="/"?"index.html":X;V=J.join(T,X);return exports.exists(V,function(Z){if(!Z){if(X==="/favicon.ico"){console.warn("404","Not found",X)}W.writeHead(404,{"Content-Type":"text/plain"});W.write("404 Not found\n"+V+"\n");W.end();return}return B.readFile(V,"binary",function(b,a){if(b){console.error("500","Server error",X);W.writeHead(500,{"Content-Type":"text/plain"});W.write(""+b+"\n"+V+"\n");W.end();return}console.info("200","OK",X);W.writeHead(200,{"Content-Type":U(X)});W.write(a,"binary");return W.end()})})};return N.createServer(S)};Q.createStaticServer.CONTENT_TYPES={".html":"text/html",".js":"text/javascript",".css":"text/css",".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif"};Q.download=function(U,T,S){var V;U=F.parse(U);if(U.href.lastIndexOf("https",0)===0){V=D}else{V=N}return V.get(U,function(X){var W;if(X.statusCode===200){W=[];X.setEncoding("binary");X.on("data",function(Y){return W.push(Y)});return X.on("end",function(){return B.writeFile(T,W.join(""),"binary",function(Y){if(Y){throw Y}if(S){return S()}})})}})};exports.network=Q;C=function(S){console.error(S+"\n");console.log('To see a list of all tasks/options, run "cake"');return process.exit(1)};P=function(S){return C("No such task: "+S)};G=function(S){return function(V,U){var T;T=S(V,U);if(U&&T!==false){U(V)}return T}};R=function(T,U,V){var S;task(T,U,V);S=G(V);return R.tasks[T]={name:T,description:U,action:S}};R.tasks={};A=function(T,S,U){if(!R.tasks[T]){P(T)}R.tasks[T].action(S,U);return false};exports.task2=global.task2=R;exports.invoke2=global.invoke2=A;O={};O.TEMPLATE_FILENAME="test.html.template";O.loadTemplate=function(U,Y,Z,X,T){var W,V,S;if(X==null){X="utf-8"}S=require("underscore");W=function(a){return B.readFile(a,X,function(c,d){var b;b=S.template(d);return T(b({javascripts:Y,stylesheets:Z}))})};V=J.join(U,O.TEMPLATE_FILENAME);if(!exports.existsSync(V)){return O.downloadTemplate(U,function(){return W(V)})}else{return W(V)}};O.downloadTemplate=function(T,S){var U;U=J.join(T,O.TEMPLATE_FILENAME);return exports.network.download(O.downloadTemplate.TEMPLATE_URL,U,S)};O.downloadTemplate.TEMPLATE_URL="https://raw.github.com/gist/4128967/test.html.template";O.downloadVenders=function(Z,V,X){var S,W,a,T,Y,U;a=require("underscore");Y=O.downloadVenders.VENDERS;if(V){Y=a.extend(Y,V)}W=Y.length;U=[];for(S in Y){T=Y[S];U.push((function(b,c){b=J.join(Z,b);return exports.network.download(c,b,function(){M.success("Download",c);if(X&&--W===0){return X()}})})(S,T))}return U};O.downloadVenders.VENDERS={"jquery.min.js":"http://code.jquery.com/jquery.min.js","mocha.js":"https://raw.github.com/visionmedia/mocha/master/mocha.js","mocha.css":"https://raw.github.com/visionmedia/mocha/master/mocha.css","expect.js":"https://raw.github.com/LearnBoost/expect.js/master/expect.js","underscore-min.js":"http://underscorejs.org/underscore-min.js","backbone-min.js":"http://backbonejs.org/backbone-min.js","reporter.js":"https://raw.github.com/TwoApart/JSCovReporter/master/reporter.js","reporter.css":"https://raw.github.com/TwoApart/JSCovReporter/master/reporter.css","JSCovReporter.js":"https://raw.github.com/TwoApart/JSCovReporter/master/JSCovReporter.js"};exports.test=O;L=require("child_process").exec;exports.minify=function(V,W,T){var U,S;S=B.statSync(V);U=["-jar",exports.minify.YUI_COMPRESSOR,V,"-o",W];return L("java "+U.join(" "),function(Z,X,Y){var a;if(Z){throw Z}if(X){console.log(X)}if(Y){console.warn(Y)}a=B.statSync(W);if(T){return T(S.size,a.size)}})};exports.minify.YUI_COMPRESSOR="~/.yuicompressor/build/yuicompressor.jar";exports.coffeelint=function(V,U,S){var T,W;if(U){T=["-f",U].concat(V)}else{T=V}W=exports.execFile(exports.coffeelint.COFFEELINT,T);return W.on("exit",function(X){if(S){return S(X)}})};exports.coffeelint.COFFEELINT="./node_modules/coffeelint/bin/coffeelint";exports.mocha=function(W,U,S){var V,T;V=["--reporter",U||"spec","--compilers","coffee:coffee-script"].concat(W);T=exports.execFile(exports.mocha.MOCHA,V);return T.on("exit",function(X){if(S){return S(X)}})};exports.mocha.MOCHA="./node_modules/mocha/bin/mocha";exports.phantomjs=function(V,T,S){var U,W;U=["--reporter",T||"spec",V];W=exports.execFile(exports.phantomjs.PHANTOMJS,U);return W.on("exit",function(X){if(S){return S(X)}})};exports.phantomjs.PHANTOMJS="./node_modules/mocha-phantomjs/bin/mocha-phantomjs";exports.coverjs=function(U,W,S){var T,V;T=["--recursive"].concat(U).concat(["--output",W]);V=exports.execFile(exports.coverjs.COVERJS,T);return V.on("exit",function(X){if(S){return S(X)}})};exports.coverjs.COVERJS="./node_modules/coverjs/bin/cover.js"}).call(this);