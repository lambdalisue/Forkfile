/**
 * Forkfile 0.2.1
 *
 * Author:  lambdalisue
 * URL:     http://hashnote.net/
 * License: MIT License
 *
 * Copyright (C) 2012 lambdalisue, hashnote.net all right reserved.
 */
(function(){var e,i,g,l,c,b,n,d,a,m,p,q,j,h,r,o,f,k=[].slice;e=(function(){s.reset="\x1b[0m";s.bold="\x1b[1m";s.red="\x1b[31m";s.green="\x1b[32m";s.check="\u2713";s.cross="\u2A2F";function s(){var t=this;this.noColor=false;this.log.strong=function(){var u;u=1<=arguments.length?k.call(arguments,0):[];if(!t.noColor){u.unshift(s.bold)}if(!t.noColor){u.push(s.reset)}return t.log.apply(t,u)};this.info.strong=function(){var u;u=1<=arguments.length?k.call(arguments,0):[];if(!t.noColor){u.unshift(s.bold)}if(!t.noColor){u.unshift(s.green)}if(!t.noColor){u.push(s.reset)}return t.log.apply(t,u)};this.error.strong=function(){var u;u=1<=arguments.length?k.call(arguments,0):[];if(!t.noColor){u.unshift(s.bold)}if(!t.noColor){u.unshift(s.red)}if(!t.noColor){u.push(s.reset)}return t.warn.apply(t,u)}}s.prototype.log=console.log;s.prototype.warn=console.warn;s.prototype.info=function(){var t;t=1<=arguments.length?k.call(arguments,0):[];if(!this.noColor){t.unshift(s.green)}if(!this.noColor){t.push(s.reset)}return this.log.apply(this,t)};s.prototype.error=function(){var t;t=1<=arguments.length?k.call(arguments,0):[];if(!this.noColor){t.unshift(s.red)}if(!this.noColor){t.push(s.reset)}return this.warn.apply(this,t)};s.prototype.success=function(){var t;t=1<=arguments.length?k.call(arguments,0):[];t.unshift(s.check);return this.info.apply(this,t)};s.prototype.fail=function(){var t;t=1<=arguments.length?k.call(arguments,0):[];t.unshift(s.cross);return this.error.apply(this,t)};return s})();exports.konsole=m=new e;b=require("fs");j=require("path");h=require("child_process").spawn;exports.installRequiredModules=function(x){var v,w,s,y,u,t;v=function(z){return exports.execFile("npm",["install",z])};console.log.strong("Install required node modeles...");s=exports.installRequiredModules.REQUIRED_NODE_MODULES;if(x){s=s.concat(x)}t=[];for(y=0,u=s.length;y<u;y++){w=s[y];t.push(v(w))}return t};exports.installRequiredModules.REQUIRED_NODE_MODULES=["underscore","coffee-script","less","glob","mkdirp","coffeelint","coverjs","mocha","expect.js","mocha-phantomjs"];exports.exists=b.exists||j.exists;exports.existsSync=b.existsSync||j.existsSync;exports.execFile=function(v,u,t){var s;s=h(v,u);s.stdout.on("data",function(w){return process.stdout.write(w)});s.stderr.on("data",function(w){return process.stderr.write(w)});if(t){s.on("exit",function(w){return t(w)})}return s};exports.readAllFiles=function(t,u,z){var v,s,A,x,y,B,w;if(!z){z=u;u="utf-8"}s=new Array;x=t.length;w=[];for(A=y=0,B=t.length;y<B;A=++y){v=t[A];w.push((function(D,C){return b.readFile(D,u,function(E,F){if(E){throw E}s[C]=F;if(--x===0){return z(s.join("\n"))}})})(v,A))}return w};exports.compose=function(u,v,t,s){return exports.readAllFiles(u,t,function(w){return b.writeFile(v,w,t,function(x){if(x){throw x}if(s){return s()}})})};exports.makedirs=function(s){var t;t=require("mkdirp");if(!exports.existsSync(s)){return t.sync(s)}};exports.copyFile=function(u,w,v){var s,t;s=b.createReadStream(u);t=b.createWriteStream(w);s.pipe(t);return s.on("end",function(){if(v){return v()}})};exports.globset=function(s,z,t){var w,y,C,x,B,v,u,A;y=require("glob");B=require("underscore");C={cwd:z};w=new Array;for(u=0,A=s.length;u<A;u++){x=s[u];if(x.lastIndexOf("-",0)===0){x=x.slice(1);if(t){x=x+t}v=y.sync(x,C);w=B.difference(w,v)}else{if(t){x=x+t}v=y.sync(x,C);w=w.concat(v)}}w=B.uniq(w);return B.map(w,function(D){return j.join(z,D)})};i={};i.coffee=function(u,w,t,s){var v;v=require("coffee-script");exports.makedirs(j.dirname(w));return b.readFile(u,t.encoding,function(y,x){var z;if(y){m.fail("Failed to read",u);m.error("  Error:",y.message);if(s){s(y)}return}try{z=v.compile(x,{bare:t.bare})}catch(y){m.fail("Failed to compile",u);m.error("  Error:",y.message);if(s){s(y)}return}return b.writeFile(w,z,t.encoding,function(A){if(A){m.fail("Failed to write",w);m.error("  Error:",A.message);if(s){s(A)}return}m.success("Compile",j.join(u),"to",w);if(s){return s()}})})};i.less=function(v,x,u,s){var t,w;t=require("less");exports.makedirs(j.dirname(x));w=new t.Parser({paths:[j.dirname(v)],filename:x});return b.readFile(v,u.encoding,function(z,y){if(z){m.fail("Failed to read",v);m.error("  Error:",z.message);if(s){s(z)}return}return w.parse(y,function(C,A){var B;if(C){m.fail("Failed to parse",v);m.error("  Error:",C.message);if(s){s(C)}return}B=A.toCSS();return b.writeFile(x,B,u.encoding,function(D){if(D){m.fail("Failed to write",x);m.error("  Error:",D.message);if(s){s(D)}return}m.success("Compile",j.join(v),"to",x);if(s){return s()}})})})};exports.compiler=i;f=require("url");n=require("http");d=require("https");q={};q.createStaticServer=function(t){var s;s=function(y,w){var v,u,x;u=function(B){var D,A,z,C;A=j.extname(B);C=q.createStaticServer.CONTENT_TYPES;for(z in C){D=C[z];if(z===A){return D}}return"text/plain"};x=f.parse(y.url).pathname;x=x==="/"?"index.html":x;v=j.join(t,x);return exports.exists(v,function(z){if(!z){if(x==="/favicon.ico"){console.warn("404","Not found",x)}w.writeHead(404,{"Content-Type":"text/plain"});w.write("404 Not found\n"+v+"\n");w.end();return}return b.readFile(v,"binary",function(B,A){if(B){console.error("500","Server error",x);w.writeHead(500,{"Content-Type":"text/plain"});w.write(""+B+"\n"+v+"\n");w.end();return}console.info("200","OK",x);w.writeHead(200,{"Content-Type":u(x)});w.write(A,"binary");return w.end()})})};return n.createServer(s)};q.createStaticServer.CONTENT_TYPES={".html":"text/html",".js":"text/javascript",".css":"text/css",".jpg":"image/jpeg",".jpeg":"image/jpeg",".png":"image/png",".gif":"image/gif"};q.download=function(u,t,s){var v;u=f.parse(u);if(u.href.lastIndexOf("https",0)===0){v=d}else{v=n}return v.get(u,function(x){var w;if(x.statusCode===200){w=[];x.setEncoding("binary");x.on("data",function(y){return w.push(y)});return x.on("end",function(){return b.writeFile(t,w.join(""),"binary",function(y){if(y){throw y}if(s){return s()}})})}})};exports.network=q;c=function(s){console.error(s+"\n");console.log('To see a list of all tasks/options, run "cake"');return process.exit(1)};p=function(s){return c("No such task: "+s)};g=function(s){return function(v,u){var t;t=s(v,u);if(u&&t!==false){u(v)}return t}};r=function(t,u,v){var s;task(t,u,v);s=g(v);return r.tasks[t]={name:t,description:u,action:s}};r.tasks={};a=function(t,s,u){if(!r.tasks[t]){p(t)}r.tasks[t].action(s,u);return false};exports.task2=global.task2=r;exports.invoke2=global.invoke2=a;o={};o.TEMPLATE_FILENAME="test.html.template";o.loadTemplate=function(u,y,z,x,t){var w,v,s;if(x==null){x="utf-8"}s=require("underscore");w=function(A){return b.readFile(A,x,function(C,D){var B;B=s.template(D);return t(B({javascripts:y,stylesheets:z}))})};v=j.join(u,o.TEMPLATE_FILENAME);if(!exports.existsSync(v)){return o.downloadTemplate(u,function(){return w(v)})}else{return w(v)}};o.downloadTemplate=function(t,s){var u;u=j.join(t,o.TEMPLATE_FILENAME);return exports.network.download(o.downloadTemplate.TEMPLATE_URL,u,s)};o.downloadTemplate.TEMPLATE_URL="https://raw.github.com/gist/4128967/test.html.template";o.downloadVenders=function(z,v,x){var s,w,A,t,y,u;A=require("underscore");y=o.downloadVenders.VENDERS;if(v){y=A.extend(y,v)}w=y.length;u=[];for(s in y){t=y[s];u.push((function(B,C){B=j.join(z,B);return exports.network.download(C,B,function(){m.success("Download",C);if(x&&--w===0){return x()}})})(s,t))}return u};o.downloadVenders.VENDERS={"jquery.min.js":"http://code.jquery.com/jquery.min.js","mocha.js":"https://raw.github.com/visionmedia/mocha/master/mocha.js","mocha.css":"https://raw.github.com/visionmedia/mocha/master/mocha.css","expect.js":"https://raw.github.com/LearnBoost/expect.js/master/expect.js","underscore-min.js":"http://underscorejs.org/underscore-min.js","backbone-min.js":"http://backbonejs.org/backbone-min.js","reporter.js":"https://raw.github.com/TwoApart/JSCovReporter/master/reporter.js","reporter.css":"https://raw.github.com/TwoApart/JSCovReporter/master/reporter.css","JSCovReporter.js":"https://raw.github.com/TwoApart/JSCovReporter/master/JSCovReporter.js"};exports.test=o;l=require("child_process").exec;exports.minify=function(v,w,t){var u,s;s=b.statSync(v);u=["-jar",exports.minify.YUI_COMPRESSOR,v,"-o",w];return l("java "+u.join(" "),function(z,x,y){var A;if(z){throw z}if(x){console.log(x)}if(y){console.warn(y)}A=b.statSync(w);if(t){return t(s.size,A.size)}})};exports.minify.YUI_COMPRESSOR="~/.yuicompressor/build/yuicompressor.jar";exports.coffeelint=function(v,u,s){var t,w;if(u){t=["-f",u].concat(v)}else{t=v}w=exports.execFile(exports.coffeelint.COFFEELINT,t);return w.on("exit",function(x){if(s){return s(x)}})};exports.coffeelint.COFFEELINT="./node_modules/coffeelint/bin/coffeelint";exports.mocha=function(w,u,s){var v,t;v=["--reporter",u||"spec","--compilers","coffee:coffee-script"].concat(w);t=exports.execFile(exports.mocha.MOCHA,v);return t.on("exit",function(x){if(s){return s(x)}})};exports.mocha.MOCHA="./node_modules/mocha/bin/mocha";exports.phantomjs=function(v,t,s){var u,w;u=["--reporter",t||"spec",v];w=exports.execFile(exports.phantomjs.PHANTOMJS,u);return w.on("exit",function(x){if(s){return s(x)}})};exports.phantomjs.PHANTOMJS="./node_modules/mocha-phantomjs/bin/mocha-phantomjs";exports.coverjs=function(u,w,s){var t,v;t=["--recursive"].concat(u).concat(["--output",w]);v=exports.execFile(exports.coverjs.COVERJS,t);return v.on("exit",function(x){if(s){return s(x)}})};exports.coverjs.COVERJS="./node_modules/coverjs/bin/cover.js"}).call(this);